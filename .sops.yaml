# SOPS Configuration for Enty Infrastructure
#
# Encryption Strategy:
# - PGP: Your Yubikey (for manual decryption)
# - Age: Argo CD (for automatic decryption in cluster)
#
# Both keys can decrypt the same files - you can read with Yubikey,
# Argo CD reads with age key
#

creation_rules:
  # Encrypted secrets for Argo CD to manage (Tailscale, etc.)
  # Path: apps/*-secret.yaml
  - path_regex: '^apps/.*-secret\.yaml$'
    key_groups:
      - age:
          - age19lq4dtrxd5qdwkr63gpy2qfwnttu3nxlrp9rxmu659nkt4d8ld7skwj6x9  # Generated by: ./scripts/setup-sops-argocd.sh
        pgp:
          - 528CFD6EA653B5EC59B701F483219063F9FC4626  # Your Yubikey key 1
          - EE213327AA06F51445BE63B5B4324BD440FD54E3  # Your Yubikey key 2
    unencrypted_regex: "^(apiVersion|metadata|kind|type|namespace|name)$"

  # Catch-all for other secrets (if any)
  - key_groups:
      - age:
          - age19lq4dtrxd5qdwkr63gpy2qfwnttu3nxlrp9rxmu659nkt4d8ld7skwj6x9
        pgp:
          - 528CFD6EA653B5EC59B701F483219063F9FC4626
          - EE213327AA06F51445BE63B5B4324BD440FD54E3
    unencrypted_regex: "^(apiVersion|metadata|kind|type)$"

# Mapping of age key file to key ID
# Generated by: age-keygen > age-argocd.key
# Format: filepath: <age_public_key_id>
age-argocd.key: age19lq4dtrxd5qdwkr63gpy2qfwnttu3nxlrp9rxmu659nkt4d8ld7skwj6x9
