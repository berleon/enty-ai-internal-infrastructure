apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Include the encrypted secret - SOPS will decrypt this before Kustomize processes it
resources:
  - ../tailscale-secret.yaml

# Helm chart with encrypted values file
helmCharts:
  - name: tailscale-operator
    repo: https://pkgs.tailscale.com/helmcharts
    version: v1.68.1
    releaseName: tailscale-operator
    namespace: tailscale
    # valuesFile will be decrypted by KSOPS plugin before passing to Helm
    valuesFile: ../tailscale-values-secret.yaml
    # Additional inline values
    valuesInline:
      replicaCount: 1
      resources:
        limits:
          cpu: 200m
          memory: 256Mi
        requests:
          cpu: 100m
          memory: 128Mi
      # Ensure pod runs in tailscale namespace
      namespace: tailscale
