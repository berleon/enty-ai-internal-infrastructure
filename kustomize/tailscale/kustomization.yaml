apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: tailscale

# Include both the SOPS-encrypted secrets
resources:
  - ../../apps/tailscale-secret.yaml

# Helm chart for the operator with encrypted values file
helmCharts:
  - name: tailscale-operator
    repo: https://pkgs.tailscale.com/helmcharts
    version: v1.68.1
    releaseName: tailscale-operator
    valuesFile: values-secret.yaml  # SOPS will decrypt this before kustomize runs
    valuesInline:
      replicaCount: 1
      resources:
        limits:
          cpu: 200m
          memory: 256Mi
        requests:
          cpu: 100m
          memory: 128Mi
